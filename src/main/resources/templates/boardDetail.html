<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>게시글 상세</title>
    <link rel="stylesheet" href="/css/board.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="/js/boardDetail.js" defer></script>
</head>
<body>

<!-- 헤더 -->
<div th:replace="~{fragment/header :: headerFragment}"></div>

<div class="container my-5">

    <!-- 게시글 상세 -->
    <div class="card mb-4">
        <div class="card-body">
            <h3 class="card-title" th:text="${board.boardTitle}">게시글 제목</h3>
            <p class="text-muted mb-2">
                작성자: <strong th:text="${board.userId}">작성자</strong> /
                작성일: <span th:text="${board.boardRegDate}">작성일</span>
            </p>
            <hr>
            <p class="card-text white-space-pre-wrap" th:text="${board.boardContent}">게시글 내용</p>

            <div class="mt-3" th:if="${session.userId == board.userId}">
                <a class="btn btn-sm btn-outline-primary"
                   th:href="@{/board/updateForm/{boardNum}(boardNum=${board.boardNum})}">수정</a>
                <a class="btn btn-sm btn-outline-danger"
                   th:href="@{/board/delete/{boardNum}(boardNum=${board.boardNum})}"
                   onclick="return confirm('정말 삭제하시겠습니까?');">삭제</a>
            </div>
        </div>
    </div>

    <!-- 댓글 영역 -->
	<div class="comments mt-5">
	    <!-- 댓글 헤더 + 목록 버튼 -->
	    <div class="d-flex justify-content-between align-items-center mb-3">
	        <h4 class="mb-0">댓글</h4>
	        <a th:href="@{/board/list}" class="btn btn-outline-secondary btn-md">목록으로</a>
	    </div>
	
	    <!-- 댓글 목록 -->
	    <div th:each="comment : ${comment}" class="border rounded p-3 mb-3" th:id="'comment-' + ${comment.commentNum}">
	        <p class="mb-1">
	            <strong th:text="${comment.userId}">작성자</strong>
	            <small class="text-muted ms-2" th:text="${comment.commentTime}">작성시간</small>
	            <span th:if="${session.userId == comment.userId}">
	                <a href="javascript:void(0);" class="text-primary ms-2"
	                   th:onclick="'showEditForm(' + ${comment.commentNum} + ');'">[수정]</a>
	                <a th:href="@{'/board/commentDelete/' + ${comment.commentNum} + '/' + ${board.boardNum}}"
	                   class="text-danger ms-1">[삭제]</a>
	            </span>
	        </p>
	        <p class="white-space-pre-wrap" th:text="${comment.commentContent}" th:id="'content-' + ${comment.commentNum}">댓글 내용</p>
	
	        <!-- 댓글 수정 폼 -->
	        <div th:id="'editForm-' + ${comment.commentNum}" class="edit-form mt-2" style="display:none;">
	            <form th:action="@{/board/commentEdit}" method="post" class="d-flex flex-column gap-2">
	                <input type="hidden" name="commentNum" th:value="${comment.commentNum}">
	                <input type="hidden" name="boardNum" th:value="${board.boardNum}">
	                <textarea name="commentContent" rows="3" class="form-control" th:text="${comment.commentContent}"></textarea>
	                <div class="d-flex gap-2">
	                    <button type="submit" class="btn btn-sm btn-primary">수정하기</button>
	                    <button type="button" class="btn btn-sm btn-secondary cancel-edit">취소</button>
	                </div>
	            </form>
	        </div>
	    </div>
	
	    <!-- 댓글 작성 폼 -->
	    <form action="/board/comment" method="post" class="d-flex gap-2 align-items-stretch">
		    <textarea name="commentContent" class="form-control" placeholder="댓글을 작성해주세요." required></textarea>
		    <input type="hidden" name="boardNum" th:value="${board.boardNum}">
		    <button type="submit" class="btn btn-success px-4">등록</button>
		</form>
	</div>
	
	<div class="text-end mt-3">
	    <a th:href="@{/board/list}" class="btn btn-outline-secondary">목록으로</a>
	</div>

</div>

<!-- 푸터 -->
<div th:replace="~{fragment/footer :: footerFragment}"></div>

</body>
</html>

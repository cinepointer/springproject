<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>마이페이지 - CinePointer</title>
    <link rel="stylesheet" href="/css/style.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
    <header class="mypage-header-simple">
        <a href="/" class="mypage-logo-link">
            <span class="mypage-logo-text">CinePointer</span>
        </a>
    </header>

    <main>
        <div class="mypage-container">
            <h1 class="mypage-title">마이페이지</h1>
            <div th:if="${user != null}" class="mypage-flex">
                <!-- 사이드 프로필 카드 -->
                <aside class="mypage-profile-card">
                    <div class="profile-username" th:text="${user.userName}">username</div>
                    <div class="profile-email" th:text="${user.userEmail}">email</div>
                </aside>
                <!-- 메인 정보 영역 -->
                <section class="mypage-info-area">
                    <!-- 내 정보 -->
                    <div class="mypage-section-box">
                        <h2 class="section-title">내 정보</h2>
                        <div class="user-info-box">
                            <p><span>이름</span> <strong th:text="${user.userName}">이름</strong></p>
                            <p><span>아이디</span> <strong th:text="${user.userId}">아이디</strong></p>
                            <p>
                                <span>비밀번호</span>
                                <strong>********</strong>
                                <button type="button" id="showPwEditBtn" class="password-edit-btn">비밀번호 수정</button>
                            </p>
                            <!-- 비밀번호 수정 폼 (초기엔 숨김) -->
                            <form id="pwEditForm" th:action="@{/users/password-edit}" method="post" style="display:none; margin-top:10px;">
    <input type="password" name="currentPassword" placeholder="현재 비밀번호" required>
    <input type="password" id="newPassword" name="newPassword" placeholder="새 비밀번호" required>
    <input type="password" id="confirmPassword" name="confirmPassword" placeholder="새 비밀번호 확인" required>
    <div id="pwMismatchMsg" style="color:red; font-size:0.9em; display:none; margin-bottom:8px;"></div>
    <button type="submit" class="password-save-btn">저장</button>
    <button type="button" id="cancelPwEditBtn" class="password-cancel-btn">취소</button>
</form>
<script>
document.addEventListener("DOMContentLoaded", function() {
    const showBtn = document.getElementById('showPwEditBtn');
    const form = document.getElementById('pwEditForm');
    const cancelBtn = document.getElementById('cancelPwEditBtn');
    const newPw = document.getElementById('newPassword');
    const confirmPw = document.getElementById('confirmPassword');
    const mismatchMsg = document.getElementById('pwMismatchMsg');

    if (showBtn && form && cancelBtn) {
        showBtn.addEventListener('click', function() {
            form.style.display = 'block';
            showBtn.style.display = 'none';
        });
        cancelBtn.addEventListener('click', function() {
            form.style.display = 'none';
            showBtn.style.display = 'inline-block';
        });
    }

    function checkPwMatch() {
        if (newPw.value && confirmPw.value && newPw.value !== confirmPw.value) {
            mismatchMsg.textContent = "비밀번호가 일치하지 않습니다.";
            mismatchMsg.style.display = "block";
        } else {
            mismatchMsg.textContent = "";
            mismatchMsg.style.display = "none";
        }
    }

    if (newPw && confirmPw && mismatchMsg) {
        newPw.addEventListener('input', checkPwMatch);
        confirmPw.addEventListener('input', checkPwMatch);

        form.addEventListener('submit', function(e) {
            if (newPw.value !== confirmPw.value) {
                mismatchMsg.textContent = "비밀번호가 일치하지 않습니다.";
                mismatchMsg.style.display = "block";
                e.preventDefault();
            }
        });
    }
});
</script>

                            <p><span>이메일</span> <strong th:text="${user.userEmail}">이메일</strong></p>
                            <p><span>생년월일</span> <strong th:text="${user.userBirthDate}">생년월일</strong></p>
                            <p><span>국가코드</span> <strong th:text="${user.userLandCd}">국가코드</strong></p>
                        </div>
                    </div>
                    <!-- 내가 찜한 영화 -->
                    <div class="mypage-section-box">
                        <h2 class="section-title">내가 찜한 영화</h2>
                        <div class="movie-list mypage-movie-list" th:if="${wishlist != null and #lists.size(wishlist) > 0}">
                            <a class="movie-card" th:each="movie : ${wishlist}" th:href="@{/movies/{id}(id=${movie.id})}" th:title="|상세보기: ${movie.title}|">
                                <div class="title" th:text="${movie.title}">영화 제목</div>
                            </a>
                        </div>
                        <div th:if="${wishlist == null or #lists.isEmpty(wishlist)}" class="no-data">
                            찜한 영화가 없습니다.
                        </div>
                    </div>
                    <!-- 내가 작성한 리뷰 -->
                    <div class="mypage-section-box">
                        <h2 class="section-title">내가 작성한 리뷰</h2>
                        <div class="review-section" th:if="${user.reviews != null and #lists.size(user.reviews) > 0}">
                            <div class="review-item" th:each="review : ${user.reviews}">
                                <a class="review-movie" th:href="@{/movies/{id}(id=${review.movieId})}" th:title="|상세보기: ${review.movieTitle}|">
                                    <strong th:text="${review.movieTitle}">영화 제목</strong>
                                </a>
                                <span class="review-rating">★ <span th:text="${review.rating}">평점</span></span>
                                <p class="review-content" th:text="${review.content}">리뷰 내용</p>
                            </div>
                        </div>
                        <div th:if="${user.reviews == null or #lists.isEmpty(user.reviews)}" class="no-data">
                            작성한 리뷰가 없습니다.
                        </div>
                    </div>
                </section>
            </div>
            <!-- user가 null일 때 에러 메시지 출력 -->
            <div th:if="${user == null}" class="error-message" style="text-align:center; color:red; margin-top:40px;">
                <p th:text="${error != null ? error : '잘못된 접근입니다.'}">회원을 찾을 수 없습니다.</p>
            </div>
        </div>
    </main>
</body>
</html>

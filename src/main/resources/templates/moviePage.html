<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title th:text="${movie.title} + ' - CinePointer'"></title>
    <link rel="stylesheet" th:href="@{/css/movie.css}">
</head>
<body>
    <!-- 네비게이션 바 -->
    <nav th:replace="fragments/nav :: nav"></nav>

    <!-- 영화 상세 정보 -->
    <section class="movie-detail">
        <div class="movie-header">
            <img th:src="${movie.posterUrl}" th:alt="${movie.title}">
            <div class="movie-info">
                <h1 th:text="${movie.title}"></h1>
                <p class="release-date" th:text="${movie.releaseDate}"></p>
                <p class="genre" th:text="${movie.genres}"></p>
                <p class="runtime" th:text="${movie.runtime + '분'}"></p>
                <div class="rating" th:text="${movie.rating}"></div>
                
                <!-- 찜하기 버튼 -->
                <button class="wishlist-btn" 
                        th:data-movie-id="${movie.id}"
                        th:classappend="${isWishlisted ? 'wishlisted' : ''}">
                    ❤ 찜하기
                </button>
            </div>
        </div>

        <div class="movie-synopsis">
            <h2>줄거리</h2>
            <p th:text="${movie.synopsis}"></p>
        </div>
    </section>

    <!-- 예고편 섹션 -->
    <section class="trailer-section">
        <h2>예고편</h2>
        <div class="video-container" th:if="${trailer != null}">
            <iframe th:src="'https://www.youtube.com/embed/' + ${trailer.videoId}"
                    frameborder="0" allowfullscreen></iframe>
        </div>
    </section>

    <!-- 출연진 및 감독 정보 -->
    <section class="cast-crew">
        <div class="director">
            <h2>감독</h2>
            <div class="person-card">
                <img th:src="${director.photoUrl}" th:alt="${director.name}">
                <p th:text="${director.name}"></p>
            </div>
        </div>

        <div class="cast">
            <h2>출연진</h2>
            <div class="cast-grid">
                <div class="person-card" th:each="actor : ${cast}">
                    <img th:src="${actor.photoUrl}" th:alt="${actor.name}">
                    <p class="actor-name" th:text="${actor.name}"></p>
                    <p class="character-name" th:text="${actor.character}"></p>
                </div>
            </div>
        </div>
    </section>

    <!-- 리뷰 섹션 -->
    <section class="reviews">
        <h2>관람객 리뷰</h2>
        <div class="review-form" th:if="${#authorization.expression('isAuthenticated()')}">
            <form th:action="@{/review/add}" method="POST">
                <input type="hidden" name="movieId" th:value="${movie.id}">
                <textarea name="content" placeholder="리뷰를 작성해주세요"></textarea>
                <div class="rating-input">
                    <input type="number" name="rating" min="1" max="5" step="0.5">
                </div>
                <button type="submit">리뷰 등록</button>
            </form>
        </div>

        <div class="review-list">
            <div class="review-card" th:each="review : ${reviews}">
                <div class="review-header">
                    <span class="user-name" th:text="${review.userName}"></span>
                    <span class="rating" th:text="${review.rating}"></span>
                    <span class="date" th:text="${review.createdAt}"></span>
                </div>
                <p class="review-content" th:text="${review.content}"></p>
            </div>
        </div>
    </section>

    <!-- 관련 영화 추천 -->
    <section class="related-movies">
        <h2>비슷한 영화</h2>
        <div class="movie-grid">
            <div class="movie-card" th:each="relatedMovie : ${relatedMovies}">
                <a th:href="@{/movie/{id}(id=${relatedMovie.id})}">
                    <img th:src="${relatedMovie.posterUrl}" th:alt="${relatedMovie.title}">
                    <h3 th:text="${relatedMovie.title}"></h3>
                </a>
            </div>
        </div>
    </section>

    <script th:src="@{/js/movie.js}"></script>
</body>
</html>
